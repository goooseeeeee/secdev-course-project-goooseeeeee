# ADR-002: Error responses in RFC 7807 format

## Context
Текущие ответы на ошибки могут содержать stack trace или чувствительную информацию (SQL, имена таблиц, конфигурацию).
Это создаёт угрозу утечки данных и затрудняет трассировку инцидентов.
Стандарт [RFC 7807](https://datatracker.ietf.org/doc/html/rfc7807) определяет единый формат сообщений об ошибках.

Покрывает STRIDE угрозы:
- I (Information Disclosure),
- R (Repudiation — отсутствие трассировки).

Связанные риски:
- R3 (утечка PII между сервисами),
- R6 (утечка файлов),
- R12 (долгое время ответа при необработанных исключениях).

## Decision
- Все ошибки сервиса возвращаются в формате RFC 7807:
  ```json
  {
    "type": "https://example.com/probs/invalid-input",
    "title": "Invalid input",
    "status": 400,
    "detail": "File is too large",
    "correlation_id": "550e8400-e29b-41d4-a716-446655440000"
  }

## Consequences
**Плюсы:**
- Сокрытие внутренних данных.
- Легче трассировать инциденты.
- Стандартизированный интерфейс ошибок.

**Минусы:**
- Потребуется рефакторинг существующих обработчиков ошибок.
- Дополнительная логика в middleware.

## Links
- NFR-06 — Обработка ошибок
- NFR-05 — HTTPS и безопасность соединений
- RISKS: R3, R6, R12
- STRIDE: I (Information Disclosure), R (Repudiation)
- F#: F1 (User → Backend)
