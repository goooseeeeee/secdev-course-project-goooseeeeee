# ADR-001: Input validation and upload safety

## Context
В сервисе используется функциональность загрузки пользовательских файлов (экспорт/импорт).
Без дополнительных мер безопасности возможны:
- загрузка вредоносных файлов (malware, zip bomb);
- path traversal атаки через `../`;
- перегрузка системы чрезмерно большим файлом;
- коллизии имён файлов.

Это создаёт угрозы по STRIDE:
- T (Tampering),
- I (Information Disclosure),
- D (Denial of Service).

Также покрывает риск **R6: Утечка экспортированных файлов** и **R8: DoS атаки**.
NFR-07 требует безопасного управления данными и файлами.

## Decision
- Проверять **реальный тип файла** через magic bytes, а не только расширение.
- Ограничить максимальный размер загружаемых файлов — 5 МБ.
- Канонизировать путь сохранения и **запретить симлинки**.
- Использовать UUID как имя файла на сервере.
- В случае нарушения правил возвращать ошибку в формате RFC 7807.

## Consequences
**Плюсы:**
- Защита от загрузки вредоносных файлов и DoS.
- Исключение path traversal и симлинк атак.
- Единый стандарт для всех API загрузок.

**Минусы:**
- Увеличение времени обработки (валидация типа).
- Необходимость дополнительного тестирования.

## Links
- NFR-07 — Управление секретами и безопасностью данных
- RISKS: R6 (утечка файлов), R8 (DoS)
- STRIDE: T, I, D (Tampering, Information Disclosure, DoS)
- F#: F4 — Export Storage
