# NFR_BDD.md — Приёмка в формате Gherkin для проекта

---

## Feature: Хранение паролей пользователей (NFR-01)
  Scenario: Хэширование паролей с использованием Argon2id
    Given пользователь регистрируется с паролем "MySecret123!"
    When система сохраняет данные пользователя
    Then пароль должен быть сохранён только в виде хэша Argon2id с солью
    And исходный пароль не должен храниться в базе данных

---

## Feature: Проверка времени отклика /wishlist (NFR-03)
  Scenario: p95 времени отклика страницы wishlist ≤ 400 мс
    Given сервер развернут на stage-среде
    And нагрузка составляет 30 RPS в течение 5 минут
    When пользователь запрашивает список желаемых вещей
    Then p95 времени отклика не должен превышать 400 миллисекунд

---

## Feature: Проверка JWT-токена при входе (NFR-02)
  Scenario: Валидный токен допускает пользователя к системе
    Given пользователь авторизован и получает JWT с TTL = 1 час
    When пользователь обращается к API /wishlist
    Then доступ должен быть разрешён
    And ответ имеет статус 200 OK

  Scenario: Невалидный или просроченный токен блокирует доступ
    Given пользователь имеет JWT с истёкшим сроком действия
    When он обращается к API /wishlist
    Then система должна вернуть статус 401 Unauthorized

---

## Feature: Проверка уязвимостей зависимостей (NFR-04)
  Scenario: Не должно быть High/Critical уязвимостей старше 7 дней
    Given CI запускает отчёт SCA при каждом коммите
    When обнаружена High или Critical уязвимость
    Then она должна быть устранена в течение 7 календарных дней

---

## Feature: Централизованное логирование событий (NFR-06)
  Scenario: Ошибки уровня error логируются в централизованную систему
    Given сервис Wishlist запущен в production
    When возникает ошибка уровня error или выше
    Then событие должно быть записано в централизованное хранилище логов
    And лог содержит correlation_id запроса

---

## Негативные сценарии (граничные случаи)

### Scenario: Перегрузка запросами (Rate Limiting, NFR-07)
  Given пользователь делает более 100 запросов к API /wishlist за минуту
  When лимит превышен
  Then система должна вернуть код 429 Too Many Requests
  And в логах фиксируется событие rate_limit_exceeded

### Scenario: Недоступность сервиса логирования
  Given основное хранилище логов недоступно
  When возникает ошибка уровня error
  Then система должна сохранить лог локально и повторить отправку позже
